/////////////////////////////////////////////////////////
//                                                     //
//               Master Hack Installer                 //
//                                                     //
/////////////////////////////////////////////////////////

#include "Extensions/Hack Installation.txt"

#ifndef FreeSpace
  #define FreeSpace 0xb2a610
  ORG FreeSpace
#endif

#ifndef ItemTable
  #define ItemTable 0x809B10
#endif

//Where SpellSystem data will be stored (4 bytes needed)
#define SelectedSpellPointer $0203A8F0 //formerly used for arena

////////////////////////////////SUPPORTING CHANGES
PUSH
  #include "_FE8EssentialFixes.event"
  
  ORG 0x18a58
  #incbin "QOL/Melee and Magic Fix_fe8.dmp"
  
POP

//Anti-Huffman Patch, by Snek, Hextator and Nintenlord
#include "Antihuffman.event"

////////////////////////////////FREE SPACE WITHIN BL RANGE
PUSH
ORG $1C21E4 
#define inBLRange
  //menu semitransparency
  #include "QOL/Semitransparency_changes.event"
  
  //press L to turn battle anims on or off
  #include "QOL/LToggle/LToggle.event"
  
#undef inBLRange
#define CurrentEndOfBLRange CURRENTOFFSET
POP

////////////////////////////////FREE SPACE OUT OF BL RANGE
//start of Free space

//Monster Weapon display fix
PUSH
  ORG $16e20
  #incbin "ItemsAndConvoy/Monsterweapon.dmp"
  ORG $892f2
  BYTE 6
  ORG $1e7fc
  BYTE 0xC
POP

//Fast promo dings
#define Time_Between_Stats 5 //default is 20
PUSH
	ORG $7F464
	BYTE Time_Between_Stats
	ORG $741E0
	BYTE Time_Between_Stats+1
POP

PUSH
	//Set Celica as main character
	//22FDC is seize usability
	ORG $37B8A 
	BYTE $0C
	ORG $37B96 
	BYTE $0C
	ORG $33274
	BYTE $0C	
	ORG $3327C
	BYTE $0C
	ORG $23F94
	BYTE $0C
	
	//Give Falcoknights Slayer
//	ORG $16C94
//	BYTE $49
//	ORG $16C98
//	BYTE $49

//	//Determines which class growths to use when autoleveling ("previous" class or current class).
//	//$7954 for vanilla, $7914 for smooth autolevel.
//	ORG $18138
//	SHORT $7914

	//Do not autolevel promoted enemies.
	ORG $18134
	SHORT $46C0 $E007
	
	//Remove the 1G item
	ORG $115AA
	BYTE $9B
	
	//Don't draw uses for unbreakables
	ORG $16A60
	//BL($A3B8)
	SHORT $1C01 $4640
	BL($4004) //Text_DrawString
	SHORT $68B0 $2308 $4018 $2800
	SHORT $D124 //BNE($16ABC) //$16A70
	SHORT $2400 $2D01 $D100 $2401
	SHORT $1C38 $3018 $1C21 $2216
	BL($4b0c) //DrawSpecialUIChar
	SHORT $2401 $2D01 $D000 $2402
	SHORT $1C38 $3016 $464B $121A $1C21
	BL($4b94) //DrawUINumberOr2Dashes
	SHORT $1C39 $311C $7D32 $1C08 $1C21
	BL($4b94) //DrawUINumberOr2Dashes
	B($16ABC)
	
	//Give Atlas/Palla a support
	
	//Disable Link Arena
	ORG $AB90E
	BYTE $00 $00 $00 $20
	
	//remove Record from tower/ruins maps
	ORG $24C49
	BYTE $E0
	
	//set thunder sword to always use ranged anim
	//ORG $582a8
	//BYTE $7
	//ORG $58290
	//BYTE $7
	
	//faster walk movement with A button
	ORG $79514
	BYTE $80
	
	//gain support by being within 2 tiles
	ORG $284E4
	BYTE $02 $28 $04 $DD
	ORG $28442
	BYTE $6D $D0
	
	//fix various things in 5x
	ORG $3327B
	BYTE $E0
	ORG $24DF2
	SHORT $0
	ORG $3164C
	BYTE $04 $E0 $00 $00
	ORG $37B95
	BYTE $E0
	
	//fix supply before ch2
	ORG $31644
	WORD $0
	ORG $31648
	WORD $0
    ORG $23f6e //Access Supply
    SHORT 0
	ORG $31630
	SHORT $DB0E //Access supply in overworld
    ORG $31646 //send to supply
    SHORT 0
	
	//allow all classes to S rank
	ORG $2c1a2
	BYTE $FB
	ORG $2c1a6
	BYTE $FB
	
	//Plot-important cutscene units
	ORG $84864 
	POIN CutsceneImportantUnitsTable
	
	//Don't boost HP even if applying hard mode bonuses
	ORG $17FE0
	BYTE 0x00 0x00
	
	//Fix ballista palette weirdness for archer/sniper
	ORG 0x599B6
	BYTE 0x14 0xE0
	
	//Fix forced range animation when an uncounterable weapon is used
	ORG 0x057278
	BYTE 0x16 0xD0
	
	// Remove arrow wiggling advancing RN
    ORG 0x1A774
    SHORT 0x2000 0
	
	//tutorial killer
	ORG $0E120
	SHORT $0
	
	ORG $16004
	SHORT $4900
	SHORT $468F
	POIN music10change

	ORG $20fac
	#incbin "QOL/kill_chapter_prologue_bgm.bin"
	ORG $20CF0
	#incbin "QOL/kill_chapter_prologue_bgm2.bin"
	ORG $20D84
	#incbin "QOL/kill_chapter_prologue_bgm2.bin"
	ORG $20D94
	#incbin "QOL/kill_chapter_prologue_bgm3.bin"
	ORG $20D00
	#incbin "QOL/kill_chapter_prologue_bgm3.bin"
	
	//lords and thieves can pick
	ORG $23E8C
	jumpToHack(MultiPick)
	
	ORG 0x58AD2
	#incbin "ItemsAndConvoy/weapon_battle_flash.dmp"
	POIN weapon_battle_flash_Table

POP

ALIGN 4
music10change:
#incbin "QOL/music10change.dmp"

//ALIGN 4
//Healing_Items_Hack:
//#incbin "ItemsAndConvoy/HealingWeapons.dmp"

ALIGN 4
#include "ItemsAndConvoy/weapon_battle_flash_Table.event"

//Bow and handaxe anim fix
#include "ItemsAndConvoy/RangedAnimation.event"
ALIGN 4

//Can't remove key items
#include "ItemsAndConvoy/trade_fix/TradeabilityChanges.event"
ALIGN 4

//Item effectiveness rework
#include "ItemsAndConvoy/EffectivenessRework/EffectivenessEA.event"
ALIGN 4

MultiPick:
#incbin "QOL/doubleRogueSkillFE8.dmp"
POIN LockpickClassTable

LockpickClassTable:
BYTE 0x01 0x02 0x03 0x04 0x17 0x18 0x33 0x00 
ALIGN 4

CutsceneImportantUnitsTable:
BYTE Lukas Clair Clive Mathilda Saber Mae Conrad Nomah Mycen 0x00
ALIGN 4


//Passive Stat Boosts w/ MSG
ALIGN 4
  #include "ModularStatGetters/StatGetters/_InstallStatGetters.event"
  
//Talk and Support don't end your turn
ALIGN 4
  #include "QOL/ContemporaryTalkSupport.event"

//HP Bars (and effective weapon warning)
ALIGN 4
  #include "QOL/HpBars/HpBars.event"

//Improved Sound Mixer
ALIGN 4
  #include "QOL/SoundEngine/SoundMixer.event"

//Danger Zone (select button)
ALIGN 4
  #include "QOL/DangerZone.event"
  
//Negative stat boosts
ALIGN 4
  #include "QOL/NegativeStatBoosts/NegativeStatBoosts.event"
  
//Modular Stat Screen
ALIGN 4
  #include "ModularStatScreen/ModularStatScreen.event"

//Range mods
ALIGN 4
  #include "ItemsAndConvoy/RangeFix/RangeModifiers.event"

//Chapter names as text
ALIGN 4
  #include "QOL/FE8_ChapterNames2/fe8_chnames.event"

ALIGN 4
  #include "HPCost/HPHealingFixes.event"
  
//Updates to the Unit Action menu
ALIGN 4
  #include "QOL/UnitActionRework/UnitActionRework.event"
  
ALIGN 4
  #include "BattleMechanics/GaidenBattleMechanics.event"
	
ALIGN 4
  #include "PromotionMechanics/GaidenPromotionMechanics.event"
  
ALIGN 4
  #include "World_Map/WorldMapHelpers.event"
  
//Save data stuff
ALIGN 4
  #include "ExpandedModularSave/ExModularSave.event"  
  
ALIGN 4
  #include "QOL/BattleStatswithAnimsOff/BattleStatsMasterEAFile.event"
  
ALIGN 4
  #include "QOL/SetConditionASMC/Set_Condition.event"
  
ALIGN 4
  #include "SupportHax/SupportSystemMods.event"
  
ALIGN 4
  #include "PostActionEvents/PostActionEvents.event"
  
ALIGN 4
  #include "HeroesMovement/HeroesMovement.event"
  
ALIGN 4
  #include "AI_Hacks/AI_Hacks.event"
  
ALIGN 4
  #include "ItemsAndConvoy/Convoy_Split_Merge/FE8-Convoy_Stuff_EA.event"
  
ALIGN 4
  #include "QOL/GuideStuff.event"

//Pressing A on an enemy lets you move next to them and attack  
ALIGN 4
  #include "QOL/MovementArrowHack/MovementArrowHack.event"
  
ALIGN 4
  #include "PopupRework/Popups.event"
  
//Various healing items and checks
ALIGN 4
  #include "ItemsAndConvoy/PassiveHealing/HPRestorationCalcLoop.event"
  
ALIGN 4
  #include "ModularMinimugBox/Installers/MMBInstallerSE.event"
  
ALIGN 4
  #include "QOL/CasualMode/CasualMode.event"
