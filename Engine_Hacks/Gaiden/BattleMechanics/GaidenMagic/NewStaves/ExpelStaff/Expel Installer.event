PUSH

	//Repoint old Mend to new Expel function, which replaces the Mine
	ORG $288B4
	POIN ExpelUsabilityCheck
	
	//Repoint old Mine usability check with Expel usability check
	//This has to be in BL range
	ORG $28BA8
	ExpelUsabilityCheck:
		New_Use(ExpelStaff_RangeSetup)
	
	//Moved these up to the big target select rework
	//Expel P4 (Target Selection)
	//ORG $28E90
	//POIN $0802901C 
	
	//ORG $2901C //Mine Range Setup - mimic Fortify here. It just goes to 2951c
	//SHORT $1C28 //mov r0, r5
	//BL($2951C)
	//B(P4Ladder_End)
	
	//Expel P1 (Use Effect)
	ORG $2FC94
	POIN $2FE7C //mine jump
	
	//Expel Exec (WIP)
	ORG $2F1D8
	//Just push lr and bx to hack in R3
	SHORT $B500
	SHORT $46C0 //nop
	callHack_r3(ExecuteExpelStaff)
	SHORT $BC01
	SHORT $4700
	
POP

//Expel stuff
ExpelEvent:
	CAM1 0xFFFF
	EARTHQUAKE_START 0x100
	STAL 30
	SOUN 0x101 //purge hit
	STAL 30
	EARTHQUAKE_END
	NoFade
	ENDA

ExpelStaff_RangeSetup:
	rfItemRangeSetup(TryAddUnitToExpelTargetList+1,Item_TURange)
ALIGN 4
TryAddUnitToExpelTargetList:
#incbin "ExpelUsabilityCheck.dmp"
ALIGN 4

ExecuteExpelStaff:
#incbin "ExecExpel_New.dmp"
WORD 0
WORD SelectedSpellPointer
POIN ExpelEffectProc
POIN SpellCostGetter
ALIGN 4

ExpelMapAnimProc:
SHORT $2; SHORT $0;  POIN $30C24+1 //init. We need to set a proc field to 0
SHORT $2; SHORT $0;  POIN $81E48+1 //Darkens map? Wraps 7f568
SHORT $E; SHORT $1;  WORD $0 //sleep 1 frame
SHORT $2; SHORT $0;  POIN $81278+1 //MapAnim_AnimateSubjectIdle. Moves staff user.
SHORT $E; SHORT $1E; WORD $0 //sleep 30 frames

SHORT $2; SHORT $0;  POIN $819E8+1 //jumps to 7d0b4 - displays the circles

SHORT $E; SHORT $2;  WORD $0 //sleep 2 frames
SHORT $E; SHORT $C8; WORD $0 //sleep 200 frames
SHORT $E; SHORT $A;  WORD $0 //sleep 10 frames
SHORT $2; SHORT $0;  POIN $8129C+1 //MapAnim_SubjectResetAnim. Returns staff user to idle anim.
SHORT $E; SHORT $1E; WORD $0 //sleep 30 frames
SHORT $2; SHORT $0;  POIN $81E54+1 //Un-darkens map? Wraps 7f5c8
SHORT $E; SHORT $1;  WORD $0 //sleep 1 frame
SHORT $2; SHORT $0;  POIN $30C40+1 //LoadTitleAnimations2Only
WORD $0; WORD $0 //end proc

ExpelEffectProc:
SHORT $E; SHORT $1;  WORD $0 //sleep 1 frame
SHORT $2; SHORT $0;  POIN $2CC1C+1 //SaveInstigatorFromBattle
SHORT $E; SHORT $1E;  WORD $0 //sleep 30 frame
WORD $0; WORD $0 //end proc
